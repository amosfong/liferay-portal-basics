@component-name = "portal-site-management"
definition {

	property app.server.types = "tomcat";
	property ci.retries.disabled = "true";
	property database.bare.enabled = "true";
	property database.types = "mysql";
	property minimum.slave.ram = "24";
	property osgi.modules.includes = "site-initializer-raylife-d2c";
	property portal.release = "true";
	property portal.upstream = "true";
	property skip.start.app.server = "true";
	property test.liferay.virtual.instance = "false";
	property test.run.type = "single";
	property testcase.url = "file:///opt/dev/projects/github/liferay-portal/";
	property testray.main.component.name = "Upgrades Solutions";

	setUp {
		Upgrade.startReleasedBundle();
	}

	@description = "LRQA-84322 - Assert that the Raylife D2C Catalog persists after upgrade from the latest quarterly release to master"
	@priority = 5
	test CanAssertRaylifeD2CCatalogAfterUpgrade {
		task ("Run pre-upgrade steps: Create a Raylife D2C site") {
			User.firstLoginUI(
				password = PropsUtil.get("default.admin.password"),
				specificURL = "http://localhost:8080",
				userEmailAddress = "test@liferay.com");

			Site.openSitesAdmin(baseURL = "http://localhost:8080");

			Site.addSiteTemplateCP(
				siteName = "Raylife D2C",
				siteTemplateName = "Raylife D2C");
		}

		task ("Upgrade") {
			Upgrade.restoreOriginalBundleAndUpgrade();

			TestUtils.hardRefresh();
		}

		task ("Assert Catalog in post-upgrade") {
			ApplicationsMenu.gotoSite(site = "Raylife D2C");

			CommerceNavigator.gotoPortlet(
				category = "Product Management",
				portlet = "Catalogs");

			AssertElementPresent(
				locator1 = "Raylife#TABLE_CATALOG_NAME",
				name = "Raylife");

			Click(
				locator1 = "Raylife#TABLE_CATALOG_NAME",
				name = "Raylife");

			AssertElementPresent(
				locator1 = "Raylife#CATALOG_TITLE",
				title = "Raylife");
		}
	}

}