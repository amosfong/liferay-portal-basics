<%--
/**
 * SPDX-FileCopyrightText: (c) 2000 Liferay, Inc. https://liferay.com
 * SPDX-License-Identifier: LGPL-2.1-or-later OR LicenseRef-Liferay-DXP-EULA-2.0.0-2023-06
 */
--%>

<clay:container-fluid>
	<div class="alert alert-success hide" id="<portlet:namespace />success">
		<p><liferay-ui:message key="the-push-notification-was-sent-successfully" /></p>
	</div>

	<div class="alert alert-danger hide" id="<portlet:namespace />error">
		<p></p>
	</div>

	<div class="alert alert-info">
		<liferay-ui:message key="beware-that-you-will-send-a-notification-to-all-registered-users" />
	</div>

	<aui:form name="fm">
		<div class="sheet">
			<div class="panel-group panel-group-flush">
				<aui:fieldset>
					<aui:input label="message" name="message" rows="6" type="textarea" />
				</aui:fieldset>
			</div>
		</div>

		<aui:button-row>
			<aui:button type="submit" value="send" />

			<aui:button type="reset" value="reset" />
		</aui:button-row>
	</aui:form>
</clay:container-fluid>

<aui:script>
	const onSendPushNotification = function (result) {
		const success = document.getElementById('<portlet:namespace />success');

		if (success) {
			success.classList.replace('show', 'hide');

			const error = document.getElementById('<portlet:namespace />error');

			if (error) {
				success.classList.replace('show', 'hide');
			}

			if (!Object.keys(result).length) {
				success.classList.replace('hide', 'show');
			}
			else {
				const paragraph = error.querySelector('p');

				if (paragraph) {
					paragraph.textContent = result;
				}

				success.classList.replace('hide', 'show');
			}
		}
	};

	const form = document.getElementById('<portlet:namespace />fm');

	if (form) {
		form.addEventListener('submit', (event) => {
			event.preventDefault();

			const message = form.querySelector('#<portlet:namespace />message');

			if (message) {
				Liferay.Service(
					'/pushnotifications.pushnotificationsdevice/send-push-notification',
					{
						payload: message.value,
						toUserIds: [],
					},
					onSendPushNotification
				);
			}
		});
	}
</aui:script>