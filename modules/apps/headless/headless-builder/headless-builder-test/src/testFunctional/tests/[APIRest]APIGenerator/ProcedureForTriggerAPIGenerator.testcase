@component-name = "portal-headless"
definition {

	property custom.properties = "feature.flag.LPS-178642=true";
	property portal.acceptance = "quarantine";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "API Builder";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();
	}

	tearDown {
		ApplicationAPI.deleteAllAPIApplication();

		var testLiferayVirtualInstance = PropsUtil.get("test.liferay.virtual.instance");

		if (${testLiferayVirtualInstance} == "true") {
			PortalInstances.tearDownCP();
		}
	}

	@priority = 4
	test OpenAPIAvailableWhenAppPublishedAndServerRestarted {
		task ("Given api-application with GET endpoint is published") {
			ApplicationAPI.createAPIApplication(
				baseURL = "app-test",
				endpointName = "testendpoint",
				endpointPath = "/testendpoint",
				relatedEndpoint = "true",
				status = "published",
				title = "App-test");
		}

		task ("Given I restart the server") {
			Portlet.shutdownServer();

			Portlet.startServer(deleteLiferayHome = "false");
		}

		task ("When I navigate to /o/application/openapi.json") {
			User.firstLoginPG();

			APIExplorer.navigateToOpenAPI(customObjectPlural = "app-test");
		}

		task ("Then the openapi.json is available") {
			WaitForElementPresent(
				locator1 = "OpenAPI#API_METHOD",
				method = "getOpenAPI",
				service = "default");

			WaitForElementPresent(
				locator1 = "OpenAPI#API_METHOD",
				method = "getTestendpointPage",
				service = "default");
		}
	}

}