task runGradleTest

String errorMessage = ""

gradle.liferayWorkspace {
	bundleChecksumSHA512 = "bad_sha512sum"
	product = "portal-7.1-ga4"
}

gradle.taskGraph.afterTask {
	Task task, TaskState taskState ->

	if (task.name.equals("verifyBundle")) {
		errorMessage = taskState.failure.cause.message

		taskState.failure = null
	}
}

runGradleTest {
	dependsOn verifyBundle

	doLast {
		assert errorMessage.contains("Expected bad_sha512sum, but got cfd68cd8dbf935efadcd66630d535e05fcd9816d1f97eff6bc38fc5bf6d44216530493887e1d86ab0368525a6c4b856a51a309769227494e4aeb7b72828dea7a")
	}
}