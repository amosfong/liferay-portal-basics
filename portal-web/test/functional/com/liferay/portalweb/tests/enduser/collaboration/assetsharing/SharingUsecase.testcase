@component-name = "portal-content-management"
definition {

	property custom.properties = "jsonws.web.service.paths.excludes=";
	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Asset Sharing";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		HeadlessSite.addSite(siteName = "Test Site");

		JSONLayout.addPublicLayout(
			groupName = "Test Site",
			layoutName = "Test Page");

		JSONUser.addUser(
			userEmailAddress = "userea@liferay.com",
			userFirstName = "userfn",
			userLastName = "userln",
			userScreenName = "usersn");

		JSONUser.setFirstPassword(
			agreeToTermsAndAnswerReminderQuery = "true",
			requireReset = "false",
			userEmailAddress = "userea@liferay.com");
	}

	tearDown {
		var testLiferayVirtualInstance = PropsUtil.get("test.liferay.virtual.instance");

		if (${testLiferayVirtualInstance} == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			JSONGroup.deleteGroupByName(groupName = "Test Site");

			JSONUser.tearDownNonAdminUsers();
		}
	}

	@description = "This test ensures that Sharing can be disabled at the instance level."
	@priority = 4
	@refactordone
	test CanDisableSharingAtInstanceScope {
		property custom.properties = "dl.actions.visible=true";
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		SystemSettings.openSystemSettingsAdmin();

		SystemSettings.gotoConfiguration(
			configurationCategory = "Sharing",
			configurationName = "Sharing",
			configurationScope = "Virtual Instance Scope");

		FormFields.disableCheckbox(fieldName = "enabled");

		SystemSettings.saveConfiguration();

		JSONLayout.addWidgetToPublicLayout(
			column = 1,
			groupName = "Test Site",
			layoutName = "Test Page",
			widgetName = "Documents and Media");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "Document with sharing disabled",
			groupName = "Test Site",
			mimeType = "application/msword",
			sourceFileName = "Document_1.doc");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs with sharing disabled",
			groupName = "Test Site");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		LexiconEntry.viewNoEntryMenuItem(
			menuItem = "Share",
			rowEntry = "Document with sharing disabled");

		DMNavigator.gotoDocumentPG(dmDocumentTitle = "Document with sharing disabled");

		AssertElementNotPresent(
			key_text = "Share",
			locator1 = "Button#ANY");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "test-site");

		LexiconEntry.viewNoEntryMenuItem(
			menuItem = "Share",
			rowEntry = "Blogs with sharing disabled");
	}

	@description = "This test ensures that Sharing can be disabled at the system level."
	@priority = 4
	@refactordone
	test CanDisableSharingAtSystemScope {
		property custom.properties = "dl.actions.visible=true";
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		SystemSettings.openSystemSettingsAdmin();

		SystemSettings.gotoConfiguration(
			configurationCategory = "Sharing",
			configurationName = "Sharing",
			configurationScope = "System Scope");

		FormFields.disableCheckbox(fieldName = "enabled");

		SystemSettings.saveConfiguration();

		JSONLayout.addWidgetToPublicLayout(
			column = 1,
			groupName = "Test Site",
			layoutName = "Test Page",
			widgetName = "Documents and Media");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "Document with sharing disabled",
			groupName = "Test Site",
			mimeType = "application/msword",
			sourceFileName = "Document_1.doc");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs with sharing disabled",
			groupName = "Test Site");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		LexiconEntry.viewNoEntryMenuItem(
			menuItem = "Share",
			rowEntry = "Document with sharing disabled");

		DMNavigator.gotoDocumentPG(dmDocumentTitle = "Document with sharing disabled");

		AssertElementNotPresent(
			key_text = "Share",
			locator1 = "Button#ANY");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "test-site");

		LexiconEntry.viewNoEntryMenuItem(
			menuItem = "Share",
			rowEntry = "Blogs with sharing disabled");
	}

	@description = "This test ensures that users can Filter By AssetType in the Shared Content app."
	@priority = 3
	@refactordone
	test CanFilterByAssetType {
		property custom.properties = "dl.actions.visible=true";

		JSONLayout.addWidgetToPublicLayout(
			groupName = "Test Site",
			layoutName = "Test Page",
			widgetName = "Documents and Media");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		JSONDocument.addFileWithUploadedFile(
			dmDocumentDescription = "DM Document Description",
			dmDocumentTitle = "DM Document Title",
			groupName = "Test Site",
			guestPermissions = "false",
			mimeType = "application/msword",
			sourceFileName = "Document_1.doc");

		JSONBlog.addEntry(
			entryContent = "Blogs Entry Content",
			entryTitle = "Blogs Entry Title",
			groupName = "Test Site");

		Navigator.gotoSitePage(
			pageName = "Test Page",
			siteName = "Test Site");

		DMNavigator.gotoShare(dmDocumentTitle = "DM Document Title");

		DMDocument.sharePG(
			userEmailAddress = "userea@liferay.com",
			userName = "userfn userln");

		BlogsNavigator.openBlogsAdmin(siteURLKey = "test-site");

		BlogsNavigator.gotoShare(entryTitle = "Blogs Entry Title");

		Asset.share(
			sharingPermissions = "View",
			userEmailAddress = "userea@liferay.com",
			userName = "userfn userln");

		User.logoutPG();

		User.loginUserPG(
			password = PropsUtil.get("default.admin.password"),
			userEmailAddress = "userea@liferay.com");

		Asset.openTosharedContent(
			navTab = "Shared with Me",
			siteURLKey = "guest");

		Asset.setFilterAndOrder(
			assetType = "Document",
			filterBy = "Asset Types");

		LexiconEntry.viewEntryName(rowEntry = "DM Document Title");

		LexiconEntry.viewNoEntry(rowEntry = "Blogs Entry Title");

		Asset.setFilterAndOrder(
			assetType = "Blogs Entry",
			filterBy = "Asset Types",
			restoreFilter = "true");

		LexiconEntry.viewEntryName(rowEntry = "Blogs Entry Title");

		LexiconEntry.viewNoEntry(rowEntry = "DM Document Title");
	}

}