@component-name = "portal-content-management"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Document Management";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		HeadlessSite.addSite(siteName = "Site 1");
	}

	tearDown {
		var testLiferayVirtualInstance = PropsUtil.get("test.liferay.virtual.instance");

		if (${testLiferayVirtualInstance} == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			DMDocument.tearDownCP();

			Site.tearDownCP();
		}
	}

	@description = "This test ensures that user cannot copy a file with a size that exceeds the limit set in the destination site."
	@priority = 4
	test CannotCopyFileThatExceedsMaxSizeSetInDestinationSite {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file.pdf",
			groupName = "Site 1",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "guest");

		DMDocument.configureMaxCopySize(
			copyLimit = 1048576,
			existingLimit = 52428800);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		DMDocument.copy(
			copyExceedsSizeLimit = "1 MB",
			dmDocumentTitle = "large_file.pdf",
			homeFolder = "true",
			limitingHierarchy = "site",
			siteName = "Liferay DXP");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.cannotViewCP(dmDocumentTitle = "large_file.pdf");
	}

	@description = "This test ensures that user cannot copy a file with a size that exceeds the limit set in site settings."
	@priority = 4
	test CannotCopyFileThatExceedsMaxSizeSetInTargetSite {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file.pdf",
			groupName = "Guest",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		DMNavigator.openToConfigInInstanceSettings(portlet = "Documents and Media Size Limits");

		DMDocument.configureMaxCopySize(
			copyLimit = 5242880,
			existingLimit = 52428800);

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "guest");

		DMDocument.configureMaxCopySize(
			copyLimit = 1048576,
			existingLimit = 5242880);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.copy(
			copyExceedsSizeLimit = "1 MB",
			dmDocumentTitle = "large_file.pdf",
			homeFolder = "true",
			immediateFailure = "true",
			limitingHierarchy = "site",
			siteName = "Liferay DXP");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		DMDocument.cannotViewCP(dmDocumentTitle = "large_file.pdf");
	}

	@description = "This test ensures that user cannot copy multiple files with a size that exceeds the limit set in the destination site."
	@priority = 4
	test CannotCopyMultipleFilesThatExceedsMaxSizeSetInDestinationSite {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file",
			groupName = "Site 1",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "Document_2",
			groupName = "Site 1",
			mimeType = "image/jpeg",
			sourceFileName = "Document_2.jpg");

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "guest");

		DMDocument.configureMaxCopySize(copyLimit = 1048576);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		LexiconEntry.changeDisplayStyle(displayStyle = "list");

		DMDocument.selectDocuments(dmDocumentTitle = "large_file,Document_2");

		DMNavigator.gotoItemViaManagementBar(
			item = "dropdownMenu",
			menuItem = "Copy To");

		DMDocument.copy(
			bulkCopy = "true",
			copyExceedsSizeLimit = "1 MB",
			homeFolder = "true",
			limitingHierarchy = "site",
			siteName = "Liferay DXP");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.cannotViewCP(dmDocumentTitle = "large_file");

		DMDocument.cannotViewCP(dmDocumentTitle = "Document_2");
	}

	@description = "This test ensures that user cannot copy multiple files with a size that exceeds the limit set in site settings."
	@priority = 4
	test CannotCopyMultipleFilesThatExceedsMaxSizeSetInTargetSite {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file",
			groupName = "Guest",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "Document_2",
			groupName = "Guest",
			mimeType = "image/jpeg",
			sourceFileName = "Document_2.jpg");

		DMNavigator.openToConfigInInstanceSettings(portlet = "Documents and Media Size Limits");

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "guest");

		DMDocument.configureMaxCopySize(copyLimit = 1048576);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.selectDocuments(dmDocumentTitle = "large_file,Document_2");

		DMNavigator.gotoItemViaManagementBar(
			item = "dropdownMenu",
			menuItem = "Copy To");

		DMDocument.copy(
			bulkCopy = "true",
			copyExceedsSizeLimit = "1 MB",
			homeFolder = "true",
			immediateFailure = "true",
			limitingHierarchy = "site",
			siteName = "Liferay DXP");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		DMDocument.cannotViewCP(dmDocumentTitle = "large_file");

		DMDocument.cannotViewCP(dmDocumentTitle = "Document_2");
	}

	@description = "This test ensures that the instance limit for file size copying will override the system limit"
	@priority = 4
	test InstanceLimitOverridesSystemLimit {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file.pdf",
			groupName = "Guest",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		DMNavigator.openToConfigInSystemSettings(portlet = "Documents and Media Size Limits");

		DMDocument.configureMaxCopySize(copyLimit = 1048576);

		DMNavigator.openToConfigInInstanceSettings(portlet = "Documents and Media Size Limits");

		DMDocument.configureMaxCopySize(
			copyLimit = 5242880,
			existingLimit = 1048576);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.copy(
			dmDocumentTitle = "large_file.pdf",
			homeFolder = "true",
			siteName = "Site 1");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		DMNavigator.gotoDocumentCP(dmDocumentTitle = "large_file.pdf");
	}

	@description = "This test ensures that the site limit for file size copying will override the instance limit"
	@priority = 4
	test SiteLimitOverridesInstanceLimit {
		property test.liferay.virtual.instance = "false";
		property test.run.type = "single";

		JSONDocument.addFileWithUploadedFile(
			dmDocumentTitle = "large_file.pdf",
			groupName = "Guest",
			mimeType = "application/pdf",
			sourceFileName = "large_file.pdf");

		DMNavigator.openToConfigInInstanceSettings(portlet = "Documents and Media Size Limits");

		DMDocument.configureMaxCopySize(copyLimit = 1048576);

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "guest");

		DMDocument.configureMaxCopySize(
			copyLimit = 5242880,
			existingLimit = 1048576);

		DMNavigator.openToConfigInSiteSettings(
			portlet = "Documents and Media Size Limits",
			siteURLKey = "site-1");

		DMDocument.configureMaxCopySize(
			copyLimit = 10485760,
			existingLimit = 1048576);

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "guest");

		DMDocument.copy(
			dmDocumentTitle = "large_file.pdf",
			homeFolder = "true",
			siteName = "Site 1");

		DMNavigator.openDocumentsAndMediaAdmin(siteURLKey = "site-1");

		DMNavigator.gotoDocumentCP(dmDocumentTitle = "large_file.pdf");
	}

}